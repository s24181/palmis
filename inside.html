<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Palmis – Virtual Tour</title>

  <!-- Icons / styles -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icons/css/flag-icons.min.css">
  <link rel="stylesheet" href="assets/styles.css">

  <!-- A-Frame for 360° -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="assets/logo/palmis-favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/logo/palmis-favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/logo/palmis-apple-180.png">
  <meta name="theme-color" content="#000000">

  <!-- Page-specific styles -->
  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow-x: hidden;
    }

    body.inside-page {
      display: flex;
      flex-direction: column;
      background: #000;
    }

    main.inside-main {
      flex: 1;
      min-height: 0;
      padding: 20px 16px 40px;
      background: #000;
    }

    /* --- Virtual Tour layout --- */
    .vt-container{
      max-width: 1200px;
      margin: 0 auto;
      color: #fff;
    }

    .vt-title{
      text-align:center;
      font-size:2rem;
      margin:10px 0 4px;
    }

    .vt-subtitle{
      text-align:center;
      opacity:.8;
      margin:0 0 16px;
      font-size:.95rem;
    }

    /* Tabs */
    .vt-tabs{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:8px;
      margin-bottom:16px;
    }

    .vt-tab{
      border:none;
      padding:6px 14px;
      border-radius:999px;
      font-size:.85rem;
      cursor:pointer;
      background:rgba(255,255,255,0.05);
      color:#fff;
      border:1px solid rgba(255,255,255,0.15);
    }

    .vt-tab.active{
      background:linear-gradient(90deg,var(--brand,#FCA384),var(--accent,#A93528));
      border-color:transparent;
    }

    /* Panels */
    .vt-panels{
      background:#000;
      border-radius:18px;
      overflow:hidden;
      box-shadow:0 14px 28px rgba(0,0,0,.55);
    }

    .vt-panel{
      display:none;
      position:relative;
    }

    .vt-panel.active{
      display:block;
    }

    /* 360 viewer */
    .vt-360-wrap a-scene{
      width:100%;
      height:420px;
    }

    .vt-hint{
      text-align:center;
      font-size:.85rem;
      opacity:.8;
      padding:8px 12px 14px;
    }

    /* Angle images */
    .vt-img-wrap{
      position:relative;
      width:100%;
      overflow:hidden;
      background:#000;
    }

    .vt-img-wrap img{
      width:100%;
      display:block;
    }

    /* Clickable zones on images */
    .table-hotspot{
      position:absolute;
      width:7%;
      height:9%;
      transform:translate(-50%,-50%);
      border-radius:8px;
      background:rgba(255,255,255,0.15); /* make transparent when finished */
      border:1px dashed rgba(255,255,255,0.6);
      cursor:pointer;
    }

    .table-hotspot:hover{
      background:rgba(255,255,255,0.30);
    }

    /* A-frame view buttons (inside 360 panel only) */
    .view-controls{
      position:absolute;
      left:50%;
      bottom:12px;
      transform:translateX(-50%);
      display:flex;
      gap:6px;
      background:rgba(0,0,0,0.45);
      padding:6px 10px;
      border-radius:999px;
      z-index:20;
      backdrop-filter:blur(6px);
    }

    .view-controls button{
      border:none;
      padding:4px 8px;
      border-radius:999px;
      font-size:0.75rem;
      cursor:pointer;
      background:rgba(255,255,255,0.9);
    }

    .view-controls button:active{
      transform:scale(0.97);
    }

    /* small tip overlay */
    #fullview-tip {
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 14px;
      background: rgba(0,0,0,0.55);
      color: white;
      font-size: 0.9rem;
      border-radius: 6px;
      z-index: 50;
      pointer-events: none;
      animation: fadeout 5s forwards;
    }

    @keyframes fadeout {
      0% { opacity: 1; }
      75% { opacity: 1; }
      100% { opacity: 0; }
    }

    @media (max-width:768px){
      main.inside-main{
        padding:16px 8px 32px;
      }
      .vt-360-wrap a-scene{
        height:320px;
      }
    }
  </style>
</head>

<body class="inside-page">

<header class="header">
  <div class="container">
    <!-- Logo / brand -->
    <a class="brand" href="index.html" aria-label="Palmis — Home">
      <img src="assets/logo/palmis-logo-cropped.jpg" alt="Palmis" class="logo">
    </a>

    <!-- Hamburger button (shows on mobile only) -->
    <button class="nav-toggle" type="button" aria-label="Toggle navigation" aria-expanded="false">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <!-- Navigation + language -->
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="menu.html">Menu</a>
      <a href="inside.html" class="active">Virtual Tour</a>
      <a href="reserve.html">Reserve</a>

      <div class="lang-selector" id="lang">
        <button id="lang-btn" type="button" aria-haspopup="listbox" aria-expanded="false">
          <span id="lang-flag" class="fi fi-gb" aria-hidden="true"></span>
          <span id="lang-code">EN</span>
          <span aria-hidden="true">▾</span>
        </button>

        <ul id="lang-menu" role="listbox" tabindex="-1" hidden>
          <li role="option" data-lang="en" tabindex="0"><span class="fi fi-gb"></span> EN</li>
          <li role="option" data-lang="fr" tabindex="0"><span class="fi fi-fr"></span> FR</li>
          <li role="option" data-lang="pl" tabindex="0"><span class="fi fi-pl"></span> PL</li>
          <li role="option" data-lang="es" tabindex="0"><span class="fi fi-es"></span> ES</li>
        </ul>
      </div>
    </nav>
  </div>
</header>

<!-- MAIN VIRTUAL TOUR CONTENT -->
<main class="inside-main">
  <section class="vt-container">
    <h1 class="vt-title">Virtual Tour</h1>
    <p class="vt-subtitle">Explore the restaurant in 360° and click a table number to start a reservation.</p>

    <!-- Tabs -->
    <div class="vt-tabs">
      <button class="vt-tab active" data-target="view-360">360° View</button>
      <button class="vt-tab" data-target="view-angle1">Angle 1 — Tables 1, 2, 6</button>
      <button class="vt-tab" data-target="view-angle2">Angle 2 — Tables 17, 19</button>
      <button class="vt-tab" data-target="view-angle3">Angle 3 — Tables 17, 18</button>
      <button class="vt-tab" data-target="view-angle4">Angle 4 — Tables 21, 22</button>
    </div>

    <!-- Panels -->
    <div class="vt-panels">

      <!-- 360° PANEL -->
      <div class="vt-panel active" id="view-360">
        <div class="vt-360-wrap">
          <a-scene embedded cursor="rayOrigin: mouse" raycaster="objects: .clickable">
            <!-- Leonardo panorama -->
<a-sky src="assets/palmis-360.jpg" rotation="0 -90 0"></a-sky>

            <!-- Camera -->
            <a-entity id="mainCamera"
                      camera
                      look-controls="pointerLockEnabled: true"
                      position="0 1.6 0">
            </a-entity>

            <!-- ONLY TABLE 5 IS CLICKABLE IN 360 -->
            <a-entity id="table5-hotspot"
                      class="clickable"
                      geometry="primitive: plane; width: 0.6; height: 0.6"
                      material="opacity: 0; transparent: true"
                      position="0 1.1 -3">
            </a-entity>

            <!-- You can add lights if needed -->
          </a-scene>

          <div id="fullview-tip">
            360° view — drag to look around. Click table 5 to reserve it.
          </div>

          <!-- Optional camera preset buttons -->
          <div class="view-controls">
            <button type="button" data-view-rot="0">Center</button>
            <button type="button" data-view-rot="-45">Left</button>
            <button type="button" data-view-rot="45">Right</button>
            <button type="button" data-view-rot="180">Back</button>
          </div>
        </div>

        <p class="vt-hint">
          Tip: use this 360° view to feel the space, then switch to another angle to choose a specific table.
        </p>
      </div>

      <!-- ANGLE 1 -->
      <div class="vt-panel" id="view-angle1">
        <div class="vt-img-wrap">
          <img src="assets/angles/angle-1-tables-1-2-6.png"
               alt="Restaurant view with tables 1, 2 and 6">

          <!-- approximate positions; adjust later if needed -->
          <button class="table-hotspot" data-table="1" style="top:60%; left:40%;"></button>
          <button class="table-hotspot" data-table="2" style="top:60%; left:63%;"></button>
          <button class="table-hotspot" data-table="6" style="top:58%; left:88%;"></button>
        </div>
      </div>

      <!-- ANGLE 2 -->
      <div class="vt-panel" id="view-angle2">
        <div class="vt-img-wrap">
          <img src="assets/angles/angle-2-tables-17-19.png"
               alt="Restaurant view with tables 17 and 19">

          <!-- table 17 (left), 19 (right) -->
          <button class="table-hotspot" data-table="17" style="top:36.9%; left:1.2%;"></button>
          <button class="table-hotspot" data-table="19" style="top:36.9%; left:98.8%;"></button>
        </div>
      </div>

      <!-- ANGLE 3 -->
      <div class="vt-panel" id="view-angle3">
        <div class="vt-img-wrap">
          <img src="assets/angles/angle-3-tables-17-18.png"
               alt="Restaurant view with tables 17 and 18">

          <button class="table-hotspot" data-table="17" style="top:37.4%; left:6.7%;"></button>
          <button class="table-hotspot" data-table="18" style="top:38.4%; left:87.3%;"></button>
        </div>
      </div>

      <!-- ANGLE 4 -->
      <div class="vt-panel" id="view-angle4">
        <div class="vt-img-wrap">
          <img src="assets/angles/angle-4-tables-21-22.png"
               alt="Restaurant view with tables 21 and 22">

          <button class="table-hotspot" data-table="21" style="top:38.5%; left:8.9%;"></button>
          <button class="table-hotspot" data-table="22" style="top:38.4%; left:95.3%;"></button>
        </div>
      </div>

    </div><!-- vt-panels -->
  </section>
</main>

<!-- FOOTER (same as before) -->
<footer class="footer">
  <p>© 2025 Palmis | Caribbean Restaurant Concept</p>
</footer>

<!-- Language selector logic (unchanged) -->
<script>
  (function(){
    const flagMap = { en:'gb', fr:'fr', pl:'pl', es:'es' };
    const btn   = document.getElementById('lang-btn');
    const menu  = document.getElementById('lang-menu');
    const flag  = document.getElementById('lang-flag');
    const code  = document.getElementById('lang-code');

    const getLang = () => {
      const parts = location.pathname.split('/').filter(Boolean);
      return ['en','fr','pl','es'].includes(parts[0]) ? parts[0] : 'en';
    };
    const getPage = () => (location.pathname.split('/').pop() || 'inside.html');
    const buildUrl = (targetLang) => {
      const cur = getLang(), page = getPage();
      if (cur === 'en') return targetLang === 'en' ? page : `${targetLang}/${page}`;
      if (targetLang === 'en') return `../${page}`;
      if (targetLang === cur)  return page;
      return `../${targetLang}/${page}`;
    };

    function syncUI(){
      const cur = getLang();
      flag.className = `fi fi-${flagMap[cur]}`;
      code.textContent = cur.toUpperCase();
    }

    btn.addEventListener('click', (e)=>{
      e.stopPropagation();
      menu.hidden = !menu.hidden;
    });

    menu.addEventListener('click', (e)=>{
      const li = e.target.closest('li[data-lang]');
      if(!li) return;
      const lang = li.dataset.lang;
      location.href = buildUrl(lang);
    });

    document.addEventListener('click', (e)=>{
      if(!menu.hidden && !btn.contains(e.target) && !menu.contains(e.target)){
        menu.hidden = true;
      }
    });

    syncUI();
  })();
</script>

<!-- Hamburger / mobile nav -->
<script>
  (function(){
    const header = document.querySelector('.header');
    const toggle = document.querySelector('.nav-toggle');
    if (!header || !toggle) return;

    toggle.addEventListener('click', function () {
      const open = header.classList.toggle('menu-open');
      toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
    });
  })();
</script>

<!-- Virtual Tour logic: tabs, hotspots, 360 camera + table 5 click -->
<script>
  // Tabs
  (function(){
    const tabs   = document.querySelectorAll('.vt-tab');
    const panels = document.querySelectorAll('.vt-panel');

    tabs.forEach(tab=>{
      tab.addEventListener('click', ()=>{
        const targetId = tab.dataset.target;
        tabs.forEach(t => t.classList.toggle('active', t === tab));
        panels.forEach(p => p.classList.toggle('active', p.id === targetId));
      });
    });
  })();

  // Flat image table hotspots -> reserve.html?table=XX
  (function(){
    const hotspots = document.querySelectorAll('.table-hotspot');
    hotspots.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const table = btn.getAttribute('data-table');
        if (!table) return;
        window.location.href = 'reserve.html?table=' + encodeURIComponent(table);
      });
    });
  })();

  // A-Frame camera view buttons + table 5 hotspot
  window.addEventListener('load', function () {
    const camera = document.querySelector('#mainCamera');
    const viewButtons = document.querySelectorAll('.view-controls button');
    viewButtons.forEach(function (btn) {
      btn.addEventListener('click', function () {
        const yaw = parseFloat(btn.dataset.viewRot) || 0;
        if (camera) {
          camera.setAttribute('rotation', '0 ' + yaw + ' 0');
        }
      });
    });

    const table5 = document.querySelector('#table5-hotspot');
    if (table5) {
      table5.addEventListener('click', function () {
        window.location.href = 'reserve.html?table=5';
      });
    }
  });
</script>

</body>
</html>
